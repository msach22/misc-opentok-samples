<!doctype html>
<html>
    <head>
        <title>Multiparty best practices</title>
        <style>
          #subscribersDiv > div {
            float: left;
          }
        </style>
    </head>
    <body>
        <div id='subscribersDiv'>
          <div id="subscriber0">
            <div class=""

          </div>
          <div id="subscriber1">

          </div>
          <div id="subscriber2">

          </div>
        </div>

        <script src='//static.opentok.com/webrtc/v2.2/js/opentok.min.js'></script>
        <script>
            var apiKey = '27086612';
            var sessionId = '1_MX4yNzA4NjYxMn5-MTQ0MzczMzgxNjI1NH4vdDFDb2x3ZjZ1WDcybGtlakRkOEhDTDh-fg';
            var token = 'T1==cGFydG5lcl9pZD0yNzA4NjYxMiZzaWc9M2Y0YTk5OTU2YjEzNGZjYjI1NWIwMmIzOTFlNDY4OGExM2ZiMGFjMzpyb2xlPXN1YnNjcmliZXImc2Vzc2lvbl9pZD0xX01YNHlOekE0TmpZeE1uNS1NVFEwTXpjek16Z3hOakkxTkg0dmRERkRiMngzWmpaMVdEY3liR3RsYWtSa09FaERURGgtZmcmY3JlYXRlX3RpbWU9MTQ0MzczMzg2NiZub25jZT0wLjEyOTQxNDcwOTE1MDUyMjEmZXhwaXJlX3RpbWU9MTQ0NjMyNTgwOSZjb25uZWN0aW9uX2RhdGE9';
            var sessions = [];

            //connect to session1 & attach it to subscriber1

            //connect to session2 & attach it to subscriber 2

            //connect to session3 & attach it to subscriber 3



            for (var i = 0; i<3; i++) {
                var session = OT.initSession(apiKey, sessionId);
                sessions.push(session);

                //this is asynchronous, and so by the time this happens... i is 3
                session.on({
                    streamCreated: function(event) {
                        var targetElement = 'subscriber';
                        var subscriber = session.subscribe(event.stream, targetElement, {insertMode: 'append'}, function (error) {
      if (error) {
        console.log(error);
      } else {
        console.log('Subscriber added.');
      }
  });

                        //this is asynchronous, and so by the time this happens... i is 3
                        if(0 == i) {
                          subscriber.restrictFrameRate(true);
                        }
                    }
                });
                session.connect(token, function(error) {
                });
            }
        </script>
    </body>
</html>
